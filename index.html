<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.3/css/bulma.min.css">
</head>

<body>
    <p>This is the bar chart that represents all the diasters and the total number of occurrences.</p>
    <svg id="container" height="600" width="1000" , style="border: solid 1px #000">
        <g id="body" style="transform:translate(150px,0px)"></g>
        <g id="yAxis"></g>
        <g id="xAxis"></g>
    </svg>
    <p>This is the line chart that represents the diasters by year.</p>
    <svg id="container2" height="600" width="1000" , style="border: solid 1px #000">
        <g id="body2" style="transform:translate(150px,0px)"></g>
        <g id="yAxis2"></g>
        <g id="xAxis2"></g>
    </svg>

    <p>This is the line chart that represents the diasters by Month.</p>
    <svg id="container3" height="600" width="1000" , style="border: solid 1px #000">
        <g id="body3" style="transform:translate(150px,0px)"></g>
        <g id="yAxis2"></g>
        <g id="xAxis2"></g>
    </svg>

    <p>This is the pie chart that represents all the diasters and the total number of occurrences. Here we are
        representing the disasters that happened more than 1000 times</p>
    <svg id="container4" height="600" width="1000" , style="border: solid 1px #000">
        <g id="body4" style="transform:translate(300px,300px)"></g>

    </svg>

</body>
<script src="d3.js"></script>

<script>
    let body = d3.select("#body")
    d3.csv("emdatDisasters.csv").then(showDataByDisaster)

    let margin = { top: 10, right: 30, bottom: 30, left: 60 },
        width = 600 - margin.left - margin.right,
        height = 400 - margin.top - margin.bottom;

    let svg = d3.select("#body2")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");

    d3.csv("emdatDisasters.csv").then(showDataByYear)

    let svg2 = d3.select("#body3")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform",
            "translate(" + margin.left + "," + margin.top + ")");
            
    d3.csv("emdatDisasters.csv").then(showDataByMonth)

    let body4 = d3.select("#body4")
    d3.csv("emdatDisasters.csv").then(showDataByDisasterPieChart)

    function showDataByDisaster(disaster) {

        let disaster_data = disaster.filter(d => { return d.Year > 1950 });

        disaster_data = d3.nest()
            .key(function (d) { return d.Disaster_Type; })
            .rollup(function (v) { return v.length; })
            .entries(disaster_data);

        disaster_data = disaster_data.map(d => ({
            disaster_name: d.key,
            disaster_count: d.value
        }))


        var max = Math.max.apply(Math, disaster_data.map(function (o) { return o.disaster_count; }))
        //console.log(max)
        let scale = d3.scaleLinear()
            .range([0, 800])
            .domain([0, max])


        let scalePosition = d3.scaleBand().range([0, 500]).domain(disaster_data.map(d => d.disaster_name))

        scalePosition.padding(0.3)

        let join = body.selectAll("rect")
            .data(disaster_data)

        join.enter().append("rect")
            .style("fill", "blue")
            .style("stroke", "white")
            .style("width", d => scale(d.disaster_count))
            .style("height", scalePosition.bandwidth())
            .style("y", d => scalePosition(d.disaster_name))

        let xAxis = d3.axisBottom(scale).ticks(5)

        d3.select("#xAxis").attr("transform", "translate(150, 500)").call(xAxis)

        let yAxis = d3.axisLeft(scalePosition)

        d3.select("#yAxis").attr("transform", "translate(150, 0)").call(yAxis)
    }

    function showDataByYear(disaster) {

        disaster = disaster.filter(d => { return d.Year != "" });
        disaster = disaster.filter(d => { return d.Year > 1950 });
        //disaster = disaster.filter(d => { return d.Disaster_Type == "Flood" });

        disaster_data_by_year = d3.nest()
            .key(function (d) { return d.Year; })
            .rollup(function (v) { return v.length; })
            .entries(disaster);

        disaster_data_by_year = disaster_data_by_year.sort(function (a, b) { return a.key - b.key; });

        disaster_data_by_year = disaster_data_by_year.map(d => ({
            disaster_year: d.key,
            disaster_count: d.value
        }))


        //console.log(disaster_data_by_year)

        var max_x = Math.max.apply(Math, disaster_data_by_year.map(function (o) { return o.disaster_year; }))
        var min_x = Math.min.apply(Math, disaster_data_by_year.map(function (o) { return o.disaster_year; }))

        var max_y = Math.max.apply(Math, disaster_data_by_year.map(function (o) { return o.disaster_count; }))

        var x = d3.scaleLinear()
            .domain([min_x, max_x])
            .range([0, width]);

        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3.scaleLinear()
            .domain([0, max_y])
            .range([height, 0]);

        svg.append("g")
            .call(d3.axisLeft(y));

        let bisect = d3.bisector(function (d) { return d.disaster_year; }).left;

        var focus = svg
            .append('g')
            .append('circle')
            .style("fill", "none")
            .attr("stroke", "black")
            .attr('r', 8.5)
            .style("opacity", 0)

        var focusText = svg
            .append('g')
            .append('text')
            .style("opacity", 0)
            .attr("text-anchor", "left")
            .attr("alignment-baseline", "middle")


        // Add the line
        svg
            .append("path")
            .datum(disaster_data_by_year)
            .attr("fill", "none")
            .attr("stroke", "steelblue")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .x(function (d) { return x(d.disaster_year) })
                .y(function (d) { return y(d.disaster_count) })
            )

        // Create a rect on top of the svg area: this rectangle recovers mouse position
        svg
            .append('rect')
            .style("fill", "none")
            .style("pointer-events", "all")
            .attr('width', width)
            .attr('height', height)
            .on('mouseover', mouseover)
            .on('mousemove', mousemove)
            .on('mouseout', mouseout);


        // What happens when the mouse move -> show the annotations at the right positions.
        function mouseover() {
            focus.style("opacity", 1)
            focusText.style("opacity", 1)
        }

        function mousemove() {
            // recover coordinate we need
            //let selectedData = ""
            var x0 = x.invert(d3.mouse(this)[0]);
            var i = bisect(disaster_data_by_year, x0, 0);
            let selectedData = disaster_data_by_year[i]
            //console.log("year:" + selectedData.disaster_year + "-" + "total:" + selectedData.disaster_count)
            focus
                .attr("cx", x(selectedData.disaster_year))
                .attr("cy", y(selectedData.disaster_count))
            focusText
                .html("year:" + selectedData.disaster_year + "-" + "total:" + selectedData.disaster_count)
                .attr("x", x(selectedData.disaster_year) + 15)
                .attr("y", y(selectedData.disaster_count))
        }
        function mouseout() {
            focus.style("opacity", 0)
            focusText.style("opacity", 0)
        }

    }

    function showDataByMonth(disaster) {

        disaster = disaster.filter(d => { return d.Start_Month != "" });
        disaster = disaster.filter(d => { return d.Year > 1950 });
        //disaster = disaster.filter(d => { return d.Disaster_Type == "Flood" });

        disaster_data_by_month = d3.nest()
            .key(function (d) { return d.Start_Month; })
            .rollup(function (v) { return v.length; })
            .entries(disaster);

        disaster_data_by_month = disaster_data_by_month.sort(function (a, b) { return a.key - b.key; });

        disaster_data_by_month = disaster_data_by_month.map(d => ({
            disaster_month: d.key,
            disaster_count: d.value
        }))


        //console.log(disaster_data_by_month)

        var max_x = Math.max.apply(Math, disaster_data_by_month.map(function (o) { return o.disaster_month; }))
        var min_x = Math.min.apply(Math, disaster_data_by_month.map(function (o) { return o.disaster_month; }))

        var max_y = Math.max.apply(Math, disaster_data_by_month.map(function (o) { return o.disaster_count; }))

        var x = d3.scaleLinear()
            .domain([min_x, max_x])
            .range([0, width]);

        svg2.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(x));

        // Add Y axis
        var y = d3.scaleLinear()
            .domain([0, max_y])
            .range([height, 0]);

        svg2.append("g")
            .call(d3.axisLeft(y));

        let bisect = d3.bisector(function (d) { return d.disaster_month; }).left;
        //console.log(bisect)
        var focus = svg2
            .append('g')
            .append('circle')
            .style("fill", "none")
            .attr("stroke", "black")
            .attr('r', 8.5)
            .style("opacity", 0)

        var focusText = svg2
            .append('g')
            .append('text')
            .style("opacity", 0)
            .attr("text-anchor", "left")
            .attr("alignment-baseline", "middle")


        // Add the line
        svg2
            .append("path")
            .datum(disaster_data_by_month)
            .attr("fill", "none")
            .attr("stroke", "steelblue")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .x(function (d) { return x(d.disaster_month) })
                .y(function (d) { return y(d.disaster_count) })
            )

        // Create a rect on top of the svg area: this rectangle recovers mouse position
        svg2
            .append('rect')
            .style("fill", "none")
            .style("pointer-events", "all")
            .attr('width', width)
            .attr('height', height)
            .on('mouseover', mouseover)
            .on('mousemove', mousemove)
            .on('mouseout', mouseout);


        // What happens when the mouse move -> show the annotations at the right positions.
        function mouseover() {
            focus.style("opacity", 1)
            focusText.style("opacity", 1)
        }

        function mousemove() {
            // recover coordinate we need
            //let selectedData = ""
            var x0 = x.invert(d3.mouse(this)[0]);
            var i = bisect(disaster_data_by_month, x0, 1);
            let selectedData = disaster_data_by_month[i]
            //console.log("Month:" + selectedData.disaster_month + "-" + "Total:" + selectedData.disaster_count)
            focus
                .attr("cx", x(selectedData.disaster_month))
                .attr("cy", y(selectedData.disaster_count))
            focusText
                .html("Month:" + selectedData.disaster_month + "-" + "Total:" + selectedData.disaster_count)
                .attr("x", x(selectedData.disaster_month) + 15)
                .attr("y", y(selectedData.disaster_count))
        }
        function mouseout() {
            focus.style("opacity", 0)
            focusText.style("opacity", 0)
        }

    }

<<<<<<< Updated upstream
    function showDataByDisasterPieChart(disaster) {
=======
    /* TODO 3
     - Use the "display flex" feature from to show the items from class `mainView` side by side
     1-3 lines of cide
    */
</style>
<body>
  <section class="hero is-primary">
    <div class="hero-body">
      <p class="title">
        Primary hero
      </p>
      <p class="subtitle">
        Primary subtitle
      </p>
    </div>
  </section>
    <h1>Airlines Routes</h1>
    <div class="mainView">
        <div>
            <h2>Airlines</h2>
            <svg id="AirlinesChart"></svg>
        </div>
        <div>
            <h2>Airports</h2>
            <svg id="Map"></svg>
        </div>
    </div>
</body>
>>>>>>> Stashed changes

        let bodyHeight = 400
        let bodyWidth = 400

        let disaster_data = disaster.filter(d => { return d.Start_Year > 1950 });

        disaster_data = d3.nest()
            .key(function (d) { return d.Disaster_Type; })
            .rollup(function (v) { return v.length; })
            .entries(disaster_data);

        disaster_data = disaster_data.map(d => ({
            disaster_name: d.key,
            disaster_count: d.value
        }))

        disaster_data = disaster_data.filter(d => { return d.disaster_count > 1000 });

        //console.log(disaster_data)

        let pie = d3.pie()
            .value(d => d.disaster_count);

        let colorScale = d3.scaleOrdinal()
            .range(d3.schemeCategory10)
            .domain(disaster_data.map(d => d.disaster_name))

        //console.log(colorScale("Flood"))
        //console.log(colorScale("Fog"))

        let arc = d3.arc()
            .outerRadius(bodyHeight / 2)
            .innerRadius(100);

        let g = body4.selectAll(".arc")
            .data(pie(disaster_data))
            .enter()
            .append("g");

        g.append("path")
            .attr("d", arc)
            .attr("fill", d => {
                return colorScale(d.data.disaster_name)
            });
        //console.log(g);

        g.append("text")
            .attr("transform", function (d) {
                return "translate(" + arc.centroid(d) + ")";
            })
            .text(function (d) {
                return d.data.disaster_name;
            })
    }
</script>

</html>